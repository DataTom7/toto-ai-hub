# Firebase App Hosting Configuration - Production Environment
# toto-ai project configuration

runConfig:
  minInstances: 2
  maxInstances: 20
  concurrency: 100
  cpu: 2
  memoryMiB: 2048

scripts:
  buildCommand: npm ci && npm run build
  runCommand: npm start
  # Note: KB sync to Vertex AI Search happens automatically on server startup
  # No need to add sync command here - it's built into the server initialization

env:
  # Google AI API Key for Gemini
  - variable: GOOGLE_AI_API_KEY
    secret: toto-ai-hub-google-ai-key-v2
    availability:
      - BUILD
      - RUNTIME

  # Firebase Configuration
  - variable: FIREBASE_PROJECT_ID
    value: toto-ai-hub
    availability:
      - BUILD
      - RUNTIME

  # Environment
  - variable: NODE_ENV
    value: "production"
    availability:
      - BUILD
      - RUNTIME

  # Toto App Staging Service Account (entire JSON as secret)
  - variable: TOTO_APP_STG_SERVICE_ACCOUNT_KEY
    secret: toto-app-stg-service-account
    availability:
      - BUILD
      - RUNTIME

  # Toto BO Service Account (entire JSON as secret) - for shared KB access
  # This allows toto-ai-hub to access the shared KB in toto-bo Firestore
  # Both staging and production instances will use this to access the same KB
  - variable: TOTO_BO_SERVICE_ACCOUNT_KEY
    secret: toto-bo-service-account
    availability:
      - BUILD
      - RUNTIME

  # Instagram Basic Display API (for accessing guardian Instagram accounts)
  # Access token and user ID for Instagram Basic Display API
  # These are used when guardian-specific tokens are not available in Firestore
  - variable: INSTAGRAM_ACCESS_TOKEN
    secret: toto-ai-hub-instagram-access-token
    availability:
      - BUILD
      - RUNTIME

  - variable: INSTAGRAM_USER_ID
    secret: toto-ai-hub-instagram-user-id
    availability:
      - BUILD
      - RUNTIME

  # Instagram Web Scraping Credentials (fallback method)
  # Used for web scraping when Basic Display API is not available
  # Note: These are less secure and may be rate-limited by Instagram
  - variable: INSTAGRAM_USERNAME
    secret: toto-ai-hub-instagram-username
    availability:
      - BUILD
      - RUNTIME

  - variable: INSTAGRAM_PASSWORD
    secret: toto-ai-hub-instagram-password
    availability:
      - BUILD
      - RUNTIME

outputFiles:
  serverApp:
    include: [dist, package.json, package-lock.json, server.js, public, node_modules]
